# TL translate

a smaller version of gettext except without features like plural forms.
Translations are stored in a folder named /translations
You convert translated text using a function like _T("")
the strings are stored in english_ref.inl generated by tl-extract-strings (LLVM AST parser + compile_commands.json)
then you duplicate the english reference and fill in the translations.

one downside with tl-extract-strings is that strings hidden behind macros are not extracted.
one workaround is to manually pass macro definitions and supported combinations (parsing ast multiple times)
or I add a domain to the translation, so replace _T("") with _TD("",enum) so that I can ignore the missing text.
For now I will just avoid hiding translations for as long I can.

the second downside is that compiling the string extractor needs LLVM, which is a huge library...
(vcpkg has llvm, I wonder how bad this is going to be...)

and the third downside is that I don't have a fuzzy matcher, I can try to match using source line info, and whole words,
otherwise, I am thinking about usingAI for fuzzy matching, but will add 100 libs as a dependency + annoying...
TODO: how should I include tl-extract-strings in this project

it should be noted that the translation language depends on a generic cvar variable
which means that any errors before loading the translation will not be translated.
This is not a big issue in my opinion, since the cvar values are english, so the errors should also be english.
I could lazy load the translation on the first string found using the global variable LANG,
but like I said, the cvar.cfg files are english, I don't make any translations while parsing the cvar.cfg file, yet.
(I might make the ASSERT dialog translated, but ASSERT must not call any functions that calls ASSERT, it's better if I don't).

If you use TL_COMPILE_TIME_TRANSLATION = ON (on by default)
Translations will be stored directly in the binary, it should be very fast.
TODO: I can static_assert if any translations are missing.

If you use TL_COMPILE_TIME_TRANSLATION = OFF
Translations will be parsed using boost parser.
the default path searched is "translations/*",
requires the install target to get it working.

At the moment you need to copy the boost parser repo directly into the source tree in a folder named "parser"
TODO: use either FetchContent or vcpkg

pass +cv_language JP to the arguments set the language to japanese.
You can also create a file named cvar.cfg with the same argument